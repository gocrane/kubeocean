# Default values for tapestry
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global configuration
global:
  # Image registry and repository
  imageRegistry: "ccr.ccs.tencentyun.com/tke-eni-test"
  # Image pull policy
  imagePullPolicy: IfNotPresent
  # Image pull secrets
  imagePullSecrets: []
  # Node selector
  nodeSelector: {}
  # Tolerations
  tolerations: []
  # Affinity
  affinity: {}

# Manager configuration
manager:
  # Enable manager deployment
  enabled: true
  # Image configuration
  image:
    repository: tapestry-manager
    tag: latest
    pullPolicy: IfNotPresent
  # Replica count
  replicas: 2
  # Resources
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  # Service account
  serviceAccount:
    create: true
    name: tapestry-manager
    annotations: {}
  # RBAC configuration
  rbac:
    create: true
    # Cluster role name
    clusterRoleName: manager-role
    # Cluster role binding name
    clusterRoleBindingName: tapestry-manager
  # Leader election configuration
  leaderElection:
    enabled: true
    id: tapestry-manager-leader
    leaseDuration: 15s
    renewDeadline: 10s
    retryPeriod: 2s
  # Kubernetes client configuration
  kubeClient:
    qps: 0  # QPS for kubernetes client (default 0 means no limit)
    burst: 0  # Burst for kubernetes client (default 0 means no limit)
  # Metrics configuration
  metrics:
    enabled: true
    port: 8080
    service:
      enabled: true
      type: ClusterIP
      port: 8080
  # Health probe configuration
  healthProbe:
    enabled: true
    port: 8081
    livenessProbe:
      initialDelaySeconds: 15
      periodSeconds: 20
    readinessProbe:
      initialDelaySeconds: 5
      periodSeconds: 10
  # Pod security context
  podSecurityContext: {}
  # Container security context
  containerSecurityContext: {}
  # Volume mounts
  volumeMounts:
    - name: syncer-template
      mountPath: /etc/tapestry/syncer-template
      readOnly: true
    - name: tz-config
      mountPath: /etc/localtime
      readOnly: true
  # Volumes
  volumes:
    - name: syncer-template
      configMap:
        name: tapestry-syncer-template
    - name: tz-config
      hostPath:
        path: /etc/localtime

# Syncer configuration
syncer:
  # Enable syncer deployment (managed by manager)
  enabled: true
  # Image configuration
  image:
    repository: tapestry-syncer
    tag: latest
    pullPolicy: IfNotPresent
  # Default replica count for syncer instances
  replicas: 2
  # Resources
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  # Service account
  serviceAccount:
    create: true
    name: tapestry-syncer
    annotations: {}
  # RBAC configuration
  rbac:
    create: true
    # Cluster role name
    clusterRoleName: tapestry-syncer
    # Cluster role binding name
    clusterRoleBindingName: tapestry-syncer
  # Leader election configuration
  leaderElection:
    enabled: true
    leaseDuration: 15s
    renewDeadline: 10s
    retryPeriod: 2s
  # Kubernetes client configuration
  kubeClient:
    virtual:
      qps: 0  # QPS for virtual kubernetes client (default 0 means no limit)
      burst: 0  # Burst for virtual kubernetes client (default 0 means no limit)
    physical:
      qps: 0  # QPS for physical kubernetes client (default 0 means no limit)
      burst: 0  # Burst for physical kubernetes client (default 0 means no limit)
  # Metrics configuration
  metrics:
    enabled: true
    port: 8080
  # Health probe configuration
  healthProbe:
    enabled: true
    port: 8081
    livenessProbe:
      initialDelaySeconds: 15
      periodSeconds: 20
    readinessProbe:
      initialDelaySeconds: 5
      periodSeconds: 10
  # Pod security context
  podSecurityContext: {}
  # Container security context
  containerSecurityContext: {}
  # Volume mounts
  volumeMounts:
    - name: tz-config
      mountPath: /etc/localtime
      readOnly: true
  # Volumes
  volumes:
    - name: tz-config
      hostPath:
        path: /etc/localtime

# CRD configuration
crd:
  # Enable CRD installation
  enabled: true
  # CRD names
  names:
    clusterBinding: clusterbindings.cloud.tencent.com
    resourceLeasingPolicy: resourceleasingpolicies.cloud.tencent.com

# Namespace configuration
namespace:
  # Create namespace
  create: true
  # Namespace name
  name: tapestry-system
  # Namespace labels
  labels:
    app.kubernetes.io/component: manager
    app.kubernetes.io/created-by: tapestry
    app.kubernetes.io/instance: system
    app.kubernetes.io/managed-by: helm
    app.kubernetes.io/name: namespace
    app.kubernetes.io/part-of: tapestry
    control-plane: tapestry-manager

# Security context configuration
securityContext: {}

# Logging configuration
logging:
  # Log level
  level: debug
  # Log format
  format: console

# Feature flags
features:
  # Enable leader election
  leaderElection: true
  # Enable metrics
  metrics: true
  # Enable health probes
  healthProbes: true
  # Enable finalizers
  finalizers: true
  # Enable webhooks
  webhooks: false
